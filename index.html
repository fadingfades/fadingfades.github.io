<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dynamic Local Video Player with Playlist and Loop</title>
<style>
  #playlist {
    margin-top: 10px;
    max-width: 640px;
  }
  .video-item {
    cursor: pointer;
    padding: 5px;
    border-bottom: 1px solid #ddd;
  }
  .video-item.active {
    font-weight: bold;
    color: blue;
    background-color: #eef;
  }
  #controls {
    margin-top: 10px;
  }
  #loopBtn {
    margin-left: 10px;
  }
</style>
</head>
<body>

<input type="file" id="fileInput" accept="video/*" multiple />
<br/>

<video id="videoPlayer" width="640" height="360" controls></video>

<div id="controls">
  <button id="prevBtn" disabled>Previous</button>
  <button id="nextBtn" disabled>Next</button>
  <button id="loopBtn" title="Loop Mode: None">Loop: None</button>
</div>

<div id="playlist"></div>

<script>
const fileInput = document.getElementById("fileInput");
const videoPlayer = document.getElementById("videoPlayer");
const playlistDiv = document.getElementById("playlist");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const loopBtn = document.getElementById("loopBtn");

let playlist = [];
let currentIndex = -1;

// Loop modes: 0 = no loop, 1 = loop current video, 2 = loop playlist
let loopMode = 0;

const loopModesText = ["None", "One", "All"];

function updateLoopButton() {
  loopBtn.textContent = `Loop: ${loopModesText[loopMode]}`;
  loopBtn.title = `Loop Mode: ${loopModesText[loopMode]}`;
  if(loopMode === 1) {
    videoPlayer.loop = true;
  } else {
    videoPlayer.loop = false;
  }
}

// Load video by index
function loadVideo(index) {
  if (index < 0 || index >= playlist.length) return;
  currentIndex = index;
  videoPlayer.src = playlist[currentIndex].url;
  videoPlayer.play();
  highlightActive();
  updateButtons();
}

// Highlight current active video in playlist UI
function highlightActive() {
  const items = document.querySelectorAll(".video-item");
  items.forEach((item, idx) => {
    item.classList.toggle("active", idx === currentIndex);
  });
}

// Update prev/next buttons disabled state
function updateButtons() {
  prevBtn.disabled = currentIndex <= 0;
  nextBtn.disabled = currentIndex >= playlist.length - 1;
}

// Create playlist UI dynamically from playlist array
function createPlaylist() {
  playlistDiv.innerHTML = "";
  playlist.forEach((video, index) => {
    const div = document.createElement("div");
    div.textContent = video.name;
    div.classList.add("video-item");
    div.addEventListener("click", () => loadVideo(index));
    playlistDiv.appendChild(div);
  });
}

// Handle file input changes — build playlist and show videos
fileInput.addEventListener("change", () => {
  const files = Array.from(fileInput.files);
  if (files.length === 0) {
    playlist = [];
    currentIndex = -1;
    videoPlayer.src = "";
    playlistDiv.innerHTML = "";
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }
  // Create object URLs for the files
  playlist = files.map((file) => ({
    name: file.name,
    url: URL.createObjectURL(file)
  }));
  createPlaylist();
  loadVideo(0);
});


// Auto-play next video on current video ended
videoPlayer.addEventListener("ended", () => {
  if (loopMode === 1) {
    // loop current video, do nothing because video.loop = true handles it
    // so this event won’t fire when loop is true (video ends won’t fire)
    // But just in case, reload current video
    // (Usually unnecessary, but safe fallback)
    loadVideo(currentIndex);
  } else if (loopMode === 2) {
    // loop whole playlist
    if (currentIndex < playlist.length - 1) {
      loadVideo(currentIndex + 1);
    } else {
      loadVideo(0);
    }
  } else {
    // no loop, just play next if exists
    if (currentIndex < playlist.length - 1) {
      loadVideo(currentIndex + 1);
    }
  }
});

// Buttons navigation
prevBtn.addEventListener("click", () => {
  if (currentIndex > 0) loadVideo(currentIndex - 1);
});
nextBtn.addEventListener("click", () => {
  if (currentIndex < playlist.length - 1) loadVideo(currentIndex + 1);
});

// Loop button cycles through modes on click
loopBtn.addEventListener("click", () => {
  loopMode = (loopMode + 1) % 3; // cycle 0->1->2->0...
  updateLoopButton();
});

// Initialize loop button display
updateLoopButton();
</script>

</body>
</html>
